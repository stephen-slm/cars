FROM golang:1.18-alpine as BUILDER

WORKDIR /app

RUN ls -la

COPY go.mod ./
COPY go.sum ./
RUN go mod download

COPY . .

RUN go build -o /runner ./cmd/services/cars-runner/main.go

FROM alpine:3.15.0

RUN mkdir /project
COPY --from=BUILDER /runner /runner

RUN apk update
RUN apk add libgdiplus --repository https://dl-3.alpinelinux.org/alpine/edge/testing/
RUN apk add sudo snap coreutils bash icu-libs krb5-libs libgcc libintl libssl1.1 libstdc++ zlib

RUN dotnet new console --language C# -o /project
RUN rm /project/Program.cs

CMD ["/runner"]
